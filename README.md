# Puppet modules for managing Foreman

Installs Foreman as a standalone application or using apache passenger.

Installs Foreman Proxy

May install an example puppet master setup using passenger as well, including the tweaks required for foreman.


# Installation

## Stable release

Releases of foreman-installer are made via RPM and deb packages and are
published via the normal Foreman repositories.

See the manual and quickstart guide available at [theforeman.org](http://theforeman.org/).

## Using GIT

git clone --recursive git://github.com/theforeman/foreman-installer.git -b develop

# Requirements

if you are using RHEL, EPEL repo must be enabled <http://fedoraproject.org/wiki/EPEL>

if you are using Debian (or Ubuntu), see the additional notes in README.debian

The Puppet Labs repositories may optionally be enabled for newer versions of Puppet
than are available in base OS repos.

# Setup

Please review the "answers" or setup file: /etc/foreman-installer/scenarios.d/foreman-answers.yaml. This file allows
you to override any of the default parameters (as specified in <module>/manifests/params.pp)

Once you are fine with your answer file, install it with this command:

    foreman-installer

or if you prefer interactive mode

    foreman-installer -i


The answer file is a yaml format. For a module just using the defaults, simply put
"modulename: true" to include, or false to exclude. For a module which you wish to
override any defaults, it becomes a hash, with each overridden parameter as a key-value
pair.

A few sample files now follow:

All-in-one installation:

    ---
    foreman: true
    puppet:
      server: true
    foreman_proxy: true

Just Foreman on its own:

    ---
    foreman: true
    puppet: false
    foreman_proxy: false

Foreman and Foreman-Proxy:

    ---
    foreman: true
    puppet: false
    foreman_proxy: true

Puppetmaster with Git and Proxy:

    ---
    foreman: false
    puppet:
      server: true
      server_git_repo: true
    foreman_proxy: true

Foreman & proxy with a different username:

    ---
    foreman:
      user: 'myforeman'
    puppet: false
    foreman_proxy:
      user: 'myproxy'

Extras
------

If you just want to include the relavant bits to run on your puppet master you may

    include foreman::params, foreman::config::enc, foreman::config::reports

# Contributing

* Fork the project
* Commit and push until you are happy with your contribution
* Send a pull request with a description of your changes

See [CONTRIBUTING.md](/CONTRIBUTING.md) for more details.

# Katello

This repository also contains the tooling required to install Foreman Katello.

See [KATELLO.md](/KATELLO.md) for details and specifics of that setup.

# Certificates

## Terminology

* **default CA** - a CA generated by the installer, and used to generate server and client certificates. This CA is used by Candlepin to generate client certificates.
* **server CA** - a CA that can be provided by the user, or is a copy of the default CA, used by all public facing interfaces
* **puppet CA** - a CA generated and managed by puppet

## Layout

### Foreman

The set of deployed certificates, private keys and CA certificates when using the Foreman scenario. Foreman defaults to using the Puppet CA, and users can provide their own certificates for any of the listed services.

| path                                                  | kind   | service       | issuer  | CA      |
|-------------------------------------------------------|--------|---------------|---------|---------|
| /etc/puppetlabs/puppet/ssl/certs/$hostname.pem        | client | foreman       | puppet  |         |
| /etc/puppetlabs/puppet/ssl/private_keys/$hostname.pem | key    | foreman       |         |         |
| /etc/puppetlabs/puppet/ssl/certs/ca.pem               | CA     | foreman       |         | puppet  |
| /etc/puppetlabs/puppet/ssl/certs/$hostname.pem        | server | websockify    | puppet  |         |
| /etc/puppetlabs/puppet/ssl/private_keys/$hostname.pem | key    | websockify    |         |         |
| /etc/puppetlabs/puppet/ssl/certs/$hostname.pem        | server | apache        | puppet  |         |
| /etc/puppetlabs/puppet/ssl/private_keys/$hostname.pem | key    | apache        |         |         |
| /etc/puppetlabs/puppet/ssl/certs/ca.pem               | CA     | apache        |         | puppet  |
| /etc/puppetlabs/puppet/ssl/certs/$hostname.pem        | server | smart-proxy   | puppet  |         |
| /etc/puppetlabs/puppet/ssl/private_keys/$hostname.pem | key    | smart-proxy   |         |         |
| /etc/puppetlabs/puppet/ssl/certs/ca.pem               | CA     | smart-proxy   |         | puppet  |
| /etc/puppetlabs/puppet/ssl/certs/$hostname.pem        | client | smart-proxy   | puppet  |         |
| /etc/puppetlabs/puppet/ssl/private_keys/$hostname.pem | key    | smart-proxy   |         |         |
| /etc/puppetlabs/puppet/ssl/certs/ca.pem               | CA     | smart-proxy   |         | puppet  |

### Katello

The set of deployed certificates, private keys and CA certificates when using the Katello scenario. Katello splits this into two phases: generation and deployment.
The generation of certificates is handled by [katello-certs-tools](https://github.com/Katello/katello-certs-tools) through puppet and then the puppet module will deploy them to standard locations.

Users may supply custom, also known as server certificates, for any public interfaces.
All client certificates, and the CA certificate used by Candlepin are generated and cannot be provided by a user.

#### Tooling

* Installs and deploys a CA
* Deploys certificates generated from the CA
* Uses [katello-certs-tools](https://github.com/Katello/katello-certs-tools) to generate certificates

#### Deployed Certificates

| path                                          | kind   | service       | issuer  | CA      |
|-----------------------------------------------|--------|---------------|---------|---------|
| /etc/foreman/client_cert.pem                  | client | foreman       | default |         |
| /etc/foreman/client_key.pem                   | key    | foreman       | default |         |
| /etc/foreman/proxy_ca.pem                     | CA     | foreman       |         | server  |
| /etc/pki/katello/certs/katello-apache.crt     | server | apache        | server  |         |
| /etc/pki/katello/private/katello-apache.key   | key    | apache        |         |         |
| /etc/pki/katello/certs/katello-server-ca.crt  | CA     | apache        |         | server  |
| /etc/pki/katello/certs/katello-default-ca.crt | CA     | apache        |         | default |
| /etc/pki/katello/certs/katello-apache.crt     | server | websockify    | server  |         |
| /etc/pki/katello/private/katello-apache.key   | key    | websockify    |         |         |
| /etc/pki/katello/private/\*-bundle.pem:cert   | client | reverse-proxy |         |         |
| /etc/pki/katello/private/\*-bundle.pem:key    | key    | reverse-proxy | default |         |
| /etc/foreman_proxy/ssl_cert.pem               | server | smart-proxy   | server  |         |
| /etc/foreman_proxy/ssl_key.pem                | key    | smart-proxy   | server  |         |
| /etc/foreman_proxy/ssl_ca.pem                 | CA     | smart-proxy   |         | default |
| /etc/foreman_proxy/foreman_ssl_cert.pem       | client | smart-proxy   | default |         |
| /etc/foreman_proxy/foreman_ssl_key.pem        | key    | smart-proxy   | default |         |
| /etc/foreman_proxy/foreman_ssl_ca.pem         | CA     | smart-proxy   |         | server  |
| /etc/candlepin/certs/candlepin-ca.crt         | CA     | candlepin     |         | default |
| /etc/candlepin/certs/candlepin-ca.key         | key    | candlepin     |         | default |
| /etc/candlepin/certs/truststore:artemis-client| client | artemis       | default |         |
| /etc/candlepin/certs/truststore:candlepin-ca  | CA     | tomcat        |         | default |
| /etc/candlepin/certs/keystore:tomcat          | server | tomcat        | default |         |
| /etc/candlepin/certs/keystore:tomcat          | key    | tomcat        |         |         |
| /etc/mosquitto/ssl/ssl_cert.pem               | cert   | mosquitto     | server  |         |
| /etc/mosquitto/ssl/ssl_key.pem                | key    | mosquitto     |         |         |
| /etc/mosquitto/ssl/ssl_ca.pem                 | CA     | mosquitto     |         | default |
| /etc/pki/katello/puppet/puppet_client.crt     | client | puppet        | default |         |
| /etc/pki/katello/puppet/puppet_client.key     | key    | puppet        |         |         |
| /etc/pki/katello/puppet/puppet_client_ca.crt  | CA     | puppet        |         | server  |

#### Generated Certificates

The certificates generated through [puppet-certs](https://github.com/theforeman/puppet-certs) using [katello-certs-tools](https://github.com/Katello/katello-certs-tools).

| path                                                         | kind   | issuer  | CA      |
|--------------------------------------------------------------|--------|---------|---------|
| /root/ssl-build/katello-ca-opnessl.cnf                       | config |         | default |
| /root/ssl-build/katello-default-ca.crt                       | CA     |         | default |
| /root/ssl-build/katello-default-ca.key                       | key    |         | default |
| /root/ssl-build/katello-server-ca.crt                        | CA     |         | server  |
| /root/ssl-build/katello-server-ca.key                        | key    |         | server  |
| /root/ssl-build/$hostname/$hostname-apache.crt               | server | server  |         |
| /root/ssl-build/$hostname/$hostname-apache.key               | key    |         |         |
| /root/ssl-build/$hostname/$hostname-foreman-client.crt       | client | default |         |
| /root/ssl-build/$hostname/$hostname-foreman-client.key       | key    |         |         |
| /root/ssl-build/$hostname/$hostname-foreman-proxy-client.crt | client | default |         |
| /root/ssl-build/$hostname/$hostname-foreman-proxy-client.key | key    |         |         |
| /root/ssl-build/$hostname/$hostname-foreman-proxy.crt        | client | server  |         |
| /root/ssl-build/$hostname/$hostname-foreman-proxy.key        | key    |         |         |
| /root/ssl-build/localhost/localhost-tomcat.crt               | server | default |         |
| /root/ssl-build/localhost/localhost-tomcat.key               | key    |         |         |

# More info

See http://theforeman.org or at #theforeman irc channel on freenode

Copyright (c) 2010-2012 Ohad Levy and their respective owners

Except where specified in provided modules, this program and entire
repository is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
